{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\admin\\\\OneDrive\\\\\\u30C9\\u30AD\\u30E5\\u30E1\\u30F3\\u30C8\\\\reactjs\\\\tailoring-app\\\\src\\\\pages\\\\ChatPanel.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from \"react\";\n\n// You must pass: userId, sellerId, userRoleId, receiverId, senderName, receiverName\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function ChatPanel({\n  userId,\n  // current user's id (customer or seller)\n  otherId,\n  // other party's id (seller or customer)\n  userRoleId,\n  // 1 for customer, 2 for seller (or per your roles)\n  otherRoleId,\n  // the other party's role id\n  senderName,\n  // name of current user\n  receiverName,\n  // name of the other user\n  chatType = \"private\"\n}) {\n  _s();\n  const [chatId, setChatId] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState(\"\");\n  const chatEndRef = useRef(null);\n\n  // Step 1: Ensure chat room exists and fetch its id\n  useEffect(() => {\n    async function getOrCreateChat() {\n      const res = await fetch(\"http://localhost:8000/api/chat_s\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          sender_id: userId,\n          receiver_id: otherId,\n          sender_role_id: userRoleId,\n          created_by: userId\n        })\n      });\n      if (res.ok) {\n        const chat = await res.json();\n        setChatId(chat.id);\n      }\n    }\n    if (userId && otherId && userRoleId && otherRoleId) getOrCreateChat();\n  }, [userId, otherId, userRoleId, otherRoleId]);\n\n  // Step 2: Fetch messages for this chat\n  useEffect(() => {\n    if (!chatId) return;\n    async function fetchMessages() {\n      const res = await fetch(`http://localhost:8000/api/chat_message_s/${chatId}`);\n      if (res.ok) {\n        const msgs = await res.json();\n        setMessages(msgs);\n      }\n    }\n    fetchMessages();\n    // Optional: Poll for new messages every 5 seconds\n    const interval = setInterval(fetchMessages, 5000);\n    return () => clearInterval(interval);\n  }, [chatId]);\n  useEffect(() => {\n    var _chatEndRef$current;\n    (_chatEndRef$current = chatEndRef.current) === null || _chatEndRef$current === void 0 ? void 0 : _chatEndRef$current.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  }, [messages]);\n\n  // Step 3: Send message\n  async function sendMessage() {\n    if (!input.trim() || !chatId) return;\n    const newMsg = {\n      message: input,\n      sender_id: userId,\n      sender_role_id: userRoleId,\n      receiver_id: otherId,\n      msg_type: \"text\"\n    };\n    const res = await fetch(`http://localhost:8000/api/chat_message_s/${chatId}`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(newMsg)\n    });\n    if (res.ok) {\n      const saved = await res.json();\n      setMessages(prev => [...prev, saved]);\n      setInput(\"\");\n    }\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"bg-white/90 shadow-xl rounded-xl w-full mt-8 animate__animated animate__fadeIn\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex items-center gap-3 p-4 border-b bg-gradient-to-r from-green-200 to-blue-200\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"font-bold text-lg text-green-700\",\n          children: receiverName\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 85,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-6 h-96 overflow-y-auto bg-gradient-to-br from-white to-blue-50\",\n      children: [messages.map((msg, idx) => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `mb-2 flex ${msg.sender_id == userId ? \"justify-end\" : \"justify-start\"}`,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `p-2 rounded-lg max-w-xs ${msg.sender_id == userId ? \"bg-green-500 text-white\" : \"bg-gray-200\"}`,\n          children: msg.message\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 13\n        }, this)\n      }, msg.id || idx, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 11\n      }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: chatEndRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-4 border-t bg-white flex gap-2\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"flex-1 border rounded px-3 py-2 focus:ring-2 focus:ring-green-300\",\n        placeholder: \"Type your message...\",\n        value: input,\n        onChange: e => setInput(e.target.value),\n        onKeyDown: e => e.key === \"Enter\" && sendMessage()\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"bg-green-600 text-white px-5 py-2 rounded hover:bg-green-700 transition\",\n        onClick: sendMessage,\n        children: \"Send\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 82,\n    columnNumber: 5\n  }, this);\n}\n_s(ChatPanel, \"gjUC/Kv8IqjBDWmIPU1BXbAsLFM=\");\n_c = ChatPanel;\nvar _c;\n$RefreshReg$(_c, \"ChatPanel\");","map":{"version":3,"names":["React","useState","useEffect","useRef","jsxDEV","_jsxDEV","ChatPanel","userId","otherId","userRoleId","otherRoleId","senderName","receiverName","chatType","_s","chatId","setChatId","messages","setMessages","input","setInput","chatEndRef","getOrCreateChat","res","fetch","method","headers","body","JSON","stringify","sender_id","receiver_id","sender_role_id","created_by","ok","chat","json","id","fetchMessages","msgs","interval","setInterval","clearInterval","_chatEndRef$current","current","scrollIntoView","behavior","sendMessage","trim","newMsg","message","msg_type","saved","prev","className","children","fileName","_jsxFileName","lineNumber","columnNumber","map","msg","idx","ref","placeholder","value","onChange","e","target","onKeyDown","key","onClick","_c","$RefreshReg$"],"sources":["C:/Users/admin/OneDrive/ドキュメント/reactjs/tailoring-app/src/pages/ChatPanel.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\n\r\n// You must pass: userId, sellerId, userRoleId, receiverId, senderName, receiverName\r\nexport default function ChatPanel({\r\n  userId,          // current user's id (customer or seller)\r\n  otherId,         // other party's id (seller or customer)\r\n  userRoleId,      // 1 for customer, 2 for seller (or per your roles)\r\n  otherRoleId,     // the other party's role id\r\n  senderName,      // name of current user\r\n  receiverName,    // name of the other user\r\n  chatType = \"private\"\r\n}) {\r\n  const [chatId, setChatId] = useState(null);\r\n  const [messages, setMessages] = useState([]);\r\n  const [input, setInput] = useState(\"\");\r\n  const chatEndRef = useRef(null);\r\n\r\n  // Step 1: Ensure chat room exists and fetch its id\r\n  useEffect(() => {\r\n    async function getOrCreateChat() {\r\n      const res = await fetch(\"http://localhost:8000/api/chat_s\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          sender_id: userId,\r\n          receiver_id: otherId,\r\n          sender_role_id: userRoleId,\r\n          created_by: userId\r\n        })\r\n      });\r\n      if (res.ok) {\r\n        const chat = await res.json();\r\n        setChatId(chat.id);\r\n      }\r\n    }\r\n    if (userId && otherId && userRoleId && otherRoleId) getOrCreateChat();\r\n  }, [userId, otherId, userRoleId, otherRoleId]);\r\n\r\n  // Step 2: Fetch messages for this chat\r\n  useEffect(() => {\r\n    if (!chatId) return;\r\n    async function fetchMessages() {\r\n      const res = await fetch(`http://localhost:8000/api/chat_message_s/${chatId}`);\r\n      if (res.ok) {\r\n        const msgs = await res.json();\r\n        setMessages(msgs);\r\n      }\r\n    }\r\n    fetchMessages();\r\n    // Optional: Poll for new messages every 5 seconds\r\n    const interval = setInterval(fetchMessages, 5000);\r\n    return () => clearInterval(interval);\r\n  }, [chatId]);\r\n\r\n  useEffect(() => {\r\n    chatEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n\r\n  // Step 3: Send message\r\n  async function sendMessage() {\r\n    if (!input.trim() || !chatId) return;\r\n    const newMsg = {\r\n      message: input,\r\n      sender_id: userId,\r\n      sender_role_id: userRoleId,\r\n      receiver_id: otherId,\r\n      msg_type: \"text\"\r\n    };\r\n    const res = await fetch(`http://localhost:8000/api/chat_message_s/${chatId}`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify(newMsg)\r\n    });\r\n    if (res.ok) {\r\n      const saved = await res.json();\r\n      setMessages(prev => [...prev, saved]);\r\n      setInput(\"\");\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"bg-white/90 shadow-xl rounded-xl w-full mt-8 animate__animated animate__fadeIn\">\r\n      <div className=\"flex items-center gap-3 p-4 border-b bg-gradient-to-r from-green-200 to-blue-200\">\r\n        <div>\r\n          <div className=\"font-bold text-lg text-green-700\">{receiverName}</div>\r\n        </div>\r\n      </div>\r\n      {/* Chat messages */}\r\n      <div className=\"p-6 h-96 overflow-y-auto bg-gradient-to-br from-white to-blue-50\">\r\n        {messages.map((msg, idx) => (\r\n          <div\r\n            key={msg.id || idx}\r\n            className={`mb-2 flex ${msg.sender_id == userId ? \"justify-end\" : \"justify-start\"}`}\r\n          >\r\n            <div\r\n              className={`p-2 rounded-lg max-w-xs ${\r\n                msg.sender_id == userId ? \"bg-green-500 text-white\" : \"bg-gray-200\"\r\n              }`}\r\n            >\r\n              {msg.message}\r\n            </div>\r\n          </div>\r\n        ))}\r\n        <div ref={chatEndRef} />\r\n      </div>\r\n      {/* Chat input */}\r\n      <div className=\"p-4 border-t bg-white flex gap-2\">\r\n        <input\r\n          className=\"flex-1 border rounded px-3 py-2 focus:ring-2 focus:ring-green-300\"\r\n          placeholder=\"Type your message...\"\r\n          value={input}\r\n          onChange={e => setInput(e.target.value)}\r\n          onKeyDown={e => e.key === \"Enter\" && sendMessage()}\r\n        />\r\n        <button className=\"bg-green-600 text-white px-5 py-2 rounded hover:bg-green-700 transition\" onClick={sendMessage}>Send</button>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}