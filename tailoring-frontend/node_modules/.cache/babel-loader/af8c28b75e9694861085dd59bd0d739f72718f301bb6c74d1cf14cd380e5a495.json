{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\admin\\\\OneDrive\\\\\\u30C9\\u30AD\\u30E5\\u30E1\\u30F3\\u30C8\\\\reactjs\\\\tailoring-app\\\\src\\\\pages\\\\ChatPage.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from \"react\";\nimport { useParams, useLocation } from \"react-router-dom\";\nimport ChatPanel from \"../components/ChatPanel\";\n\n// This ChatPage supports both full-screen direct chat (with params) and fallback for old /chat route with query string params.\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function ChatPage({\n  profile\n}) {\n  _s();\n  var _profile$seller, _profile$seller2;\n  const params = useParams();\n  const location = useLocation();\n\n  // Try to extract IDs/roles from URL params (preferred) or fallback to query params\n  let userRole, userId, otherId, receiverName;\n  if (params.userRole && params.userId && params.otherId) {\n    userRole = Number(params.userRole);\n    userId = Number(params.userId);\n    otherId = Number(params.otherId);\n  } else {\n    // Fallback: parse from query string, e.g. /chat?userRole=1&userId=12&otherId=44\n    const qs = new URLSearchParams(location.search);\n    userRole = Number(qs.get(\"userRole\") || (profile === null || profile === void 0 ? void 0 : profile.role_id));\n    userId = Number(qs.get(\"userId\") || (profile === null || profile === void 0 ? void 0 : profile.id));\n    otherId = Number(qs.get(\"otherId\"));\n  }\n\n  // Set sender/receiver roles for ChatPanel\n  let userRoleId = userRole;\n  let otherRoleId = userRole === 2 ? 1 : 2; // 1: customer, 2: seller\n\n  // Try to determine receiver name\n  if (otherRoleId === 2 && profile !== null && profile !== void 0 && (_profile$seller = profile.seller) !== null && _profile$seller !== void 0 && _profile$seller.shop_name) {\n    receiverName = profile.seller.shop_name;\n  } else {\n    receiverName = \"\"; // You may fetch receiver name if needed\n  }\n\n  // Don't render ChatPanel unless both IDs are present\n  if (!userId || !otherId || !userRoleId || !otherRoleId) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex items-center justify-center min-h-screen text-red-600\",\n      children: \"Unable to load chat: missing user information.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 39,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex min-h-screen items-center justify-center bg-gradient-to-br from-blue-50 via-green-50 to-blue-100\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"w-full max-w-2xl\",\n      children: /*#__PURE__*/_jsxDEV(ChatPanel, {\n        userId: userId,\n        otherId: otherId,\n        userRoleId: userRoleId,\n        otherRoleId: otherRoleId,\n        senderName: (profile === null || profile === void 0 ? void 0 : (_profile$seller2 = profile.seller) === null || _profile$seller2 === void 0 ? void 0 : _profile$seller2.shop_name) || (profile === null || profile === void 0 ? void 0 : profile.name),\n        receiverName: receiverName\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 48,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 47,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 46,\n    columnNumber: 5\n  }, this);\n}\n_s(ChatPage, \"XvbjsyaVL/Av168fKJzMTyJJJf4=\", false, function () {\n  return [useParams, useLocation];\n});\n_c = ChatPage;\nvar _c;\n$RefreshReg$(_c, \"ChatPage\");","map":{"version":3,"names":["React","useEffect","useState","useParams","useLocation","ChatPanel","jsxDEV","_jsxDEV","ChatPage","profile","_s","_profile$seller","_profile$seller2","params","location","userRole","userId","otherId","receiverName","Number","qs","URLSearchParams","search","get","role_id","id","userRoleId","otherRoleId","seller","shop_name","className","children","fileName","_jsxFileName","lineNumber","columnNumber","senderName","name","_c","$RefreshReg$"],"sources":["C:/Users/admin/OneDrive/ドキュメント/reactjs/tailoring-app/src/pages/ChatPage.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useParams, useLocation } from \"react-router-dom\";\r\nimport ChatPanel from \"../components/ChatPanel\";\r\n\r\n// This ChatPage supports both full-screen direct chat (with params) and fallback for old /chat route with query string params.\r\nexport default function ChatPage({ profile }) {\r\n  const params = useParams();\r\n  const location = useLocation();\r\n\r\n  // Try to extract IDs/roles from URL params (preferred) or fallback to query params\r\n  let userRole, userId, otherId, receiverName;\r\n\r\n  if (params.userRole && params.userId && params.otherId) {\r\n    userRole = Number(params.userRole);\r\n    userId = Number(params.userId);\r\n    otherId = Number(params.otherId);\r\n  } else {\r\n    // Fallback: parse from query string, e.g. /chat?userRole=1&userId=12&otherId=44\r\n    const qs = new URLSearchParams(location.search);\r\n    userRole = Number(qs.get(\"userRole\") || profile?.role_id);\r\n    userId = Number(qs.get(\"userId\") || profile?.id);\r\n    otherId = Number(qs.get(\"otherId\"));\r\n  }\r\n\r\n  // Set sender/receiver roles for ChatPanel\r\n  let userRoleId = userRole;\r\n  let otherRoleId = userRole === 2 ? 1 : 2; // 1: customer, 2: seller\r\n\r\n  // Try to determine receiver name\r\n  if (otherRoleId === 2 && profile?.seller?.shop_name) {\r\n    receiverName = profile.seller.shop_name;\r\n  } else {\r\n    receiverName = \"\"; // You may fetch receiver name if needed\r\n  }\r\n\r\n  // Don't render ChatPanel unless both IDs are present\r\n  if (!userId || !otherId || !userRoleId || !otherRoleId) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen text-red-600\">\r\n        Unable to load chat: missing user information.\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex min-h-screen items-center justify-center bg-gradient-to-br from-blue-50 via-green-50 to-blue-100\">\r\n      <div className=\"w-full max-w-2xl\">\r\n        <ChatPanel\r\n          userId={userId}\r\n          otherId={otherId}\r\n          userRoleId={userRoleId}\r\n          otherRoleId={otherRoleId}\r\n          senderName={profile?.seller?.shop_name || profile?.name}\r\n          receiverName={receiverName}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}