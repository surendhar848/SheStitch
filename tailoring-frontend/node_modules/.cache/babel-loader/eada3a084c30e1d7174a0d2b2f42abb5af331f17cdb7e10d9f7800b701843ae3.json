{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\admin\\\\OneDrive\\\\\\u30C9\\u30AD\\u30E5\\u30E1\\u30F3\\u30C8\\\\reactjs\\\\tailoring-app\\\\src\\\\components\\\\ChatPanel.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from \"react\";\n\n/**\r\n * Props:\r\n * - userId: string | number (current user)\r\n * - otherId: string | number (chat partner)\r\n * - userRoleId: 1 (customer) | 2 (seller)\r\n * - otherRoleId: 1 | 2\r\n * - senderName: string (optional)\r\n * - receiverName: string (optional)\r\n */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function ChatPanel({\n  userId,\n  otherId,\n  userRoleId,\n  otherRoleId,\n  senderName,\n  receiverName\n}) {\n  _s();\n  const [chatId, setChatId] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState(\"\");\n  const chatEndRef = useRef(null);\n\n  // Ensure chat room exists and fetch its id\n  useEffect(() => {\n    async function getOrCreateChat() {\n      const res = await fetch(\"http://localhost:8000/api/chat_s\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          sender_id: userId,\n          receiver_id: otherId,\n          sender_role_id: userRoleId,\n          created_by: userId\n        })\n      });\n      if (res.ok) {\n        var _chat$id;\n        const chat = await res.json();\n        setChatId((_chat$id = chat === null || chat === void 0 ? void 0 : chat.id) !== null && _chat$id !== void 0 ? _chat$id : null);\n      }\n    }\n    if (userId && otherId && userRoleId && otherRoleId) getOrCreateChat();\n  }, [userId, otherId, userRoleId, otherRoleId]);\n\n  // Fetch messages for this chat\n  useEffect(() => {\n    if (!chatId) return;\n    async function fetchMessages() {\n      const res = await fetch(`http://localhost:8000/api/chat_message_s/${chatId}`);\n      if (res.ok) {\n        const msgs = await res.json();\n        setMessages(Array.isArray(msgs) ? msgs.filter(Boolean) : []);\n      }\n    }\n    fetchMessages();\n    const interval = setInterval(fetchMessages, 5000);\n    return () => clearInterval(interval);\n  }, [chatId]);\n  useEffect(() => {\n    var _chatEndRef$current;\n    (_chatEndRef$current = chatEndRef.current) === null || _chatEndRef$current === void 0 ? void 0 : _chatEndRef$current.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  }, [messages]);\n  async function sendMessage() {\n    if (!input.trim() || !chatId) return;\n    const newMsg = {\n      message: input,\n      sender_id: userId,\n      sender_role_id: userRoleId,\n      receiver_id: otherId,\n      msg_type: \"text\"\n    };\n    const res = await fetch(`http://localhost:8000/api/chat_message_s/${chatId}`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(newMsg)\n    });\n    if (res.ok) {\n      const saved = await res.json();\n      setMessages(prev => [...prev, saved]);\n      setInput(\"\");\n    }\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"bg-white/90 shadow-xl rounded-xl w-full mt-8 animate__animated animate__fadeIn\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex items-center gap-3 p-4 border-b bg-gradient-to-r from-green-200 to-blue-200\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"font-bold text-lg text-green-700\",\n          children: receiverName || \"Chat\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-6 h-96 overflow-y-auto bg-gradient-to-br from-white to-blue-50\",\n      children: [(messages || []).filter(msg => msg && typeof msg === \"object\" && \"id\" in msg).map((msg, idx) => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `mb-2 flex ${msg.sender_id === userId ? \"justify-end\" : \"justify-start\"}`,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `p-2 rounded-lg max-w-xs ${msg.sender_id === userId ? \"bg-green-500 text-white\" : \"bg-gray-200\"}`,\n          children: msg.message\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 15\n        }, this)\n      }, msg.id || idx, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 13\n      }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: chatEndRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-4 border-t bg-white flex gap-2\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"flex-1 border rounded px-3 py-2 focus:ring-2 focus:ring-green-300\",\n        placeholder: \"Type your message...\",\n        value: input,\n        onChange: e => setInput(e.target.value),\n        onKeyDown: e => e.key === \"Enter\" && sendMessage()\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"bg-green-600 text-white px-5 py-2 rounded hover:bg-green-700 transition\",\n        onClick: sendMessage,\n        children: \"Send\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 87,\n    columnNumber: 5\n  }, this);\n}\n_s(ChatPanel, \"gjUC/Kv8IqjBDWmIPU1BXbAsLFM=\");\n_c = ChatPanel;\nvar _c;\n$RefreshReg$(_c, \"ChatPanel\");","map":{"version":3,"names":["React","useState","useEffect","useRef","jsxDEV","_jsxDEV","ChatPanel","userId","otherId","userRoleId","otherRoleId","senderName","receiverName","_s","chatId","setChatId","messages","setMessages","input","setInput","chatEndRef","getOrCreateChat","res","fetch","method","headers","body","JSON","stringify","sender_id","receiver_id","sender_role_id","created_by","ok","_chat$id","chat","json","id","fetchMessages","msgs","Array","isArray","filter","Boolean","interval","setInterval","clearInterval","_chatEndRef$current","current","scrollIntoView","behavior","sendMessage","trim","newMsg","message","msg_type","saved","prev","className","children","fileName","_jsxFileName","lineNumber","columnNumber","msg","map","idx","ref","placeholder","value","onChange","e","target","onKeyDown","key","onClick","_c","$RefreshReg$"],"sources":["C:/Users/admin/OneDrive/ドキュメント/reactjs/tailoring-app/src/components/ChatPanel.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\n\r\n/**\r\n * Props:\r\n * - userId: string | number (current user)\r\n * - otherId: string | number (chat partner)\r\n * - userRoleId: 1 (customer) | 2 (seller)\r\n * - otherRoleId: 1 | 2\r\n * - senderName: string (optional)\r\n * - receiverName: string (optional)\r\n */\r\nexport default function ChatPanel({\r\n  userId,\r\n  otherId,\r\n  userRoleId,\r\n  otherRoleId,\r\n  senderName,\r\n  receiverName,\r\n}) {\r\n  const [chatId, setChatId] = useState(null);\r\n  const [messages, setMessages] = useState([]);\r\n  const [input, setInput] = useState(\"\");\r\n  const chatEndRef = useRef(null);\r\n\r\n  // Ensure chat room exists and fetch its id\r\n  useEffect(() => {\r\n    async function getOrCreateChat() {\r\n      const res = await fetch(\"http://localhost:8000/api/chat_s\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          sender_id: userId,\r\n          receiver_id: otherId,\r\n          sender_role_id: userRoleId,\r\n          created_by: userId,\r\n        }),\r\n      });\r\n      if (res.ok) {\r\n        const chat = await res.json();\r\n        setChatId(chat?.id ?? null);\r\n      }\r\n    }\r\n    if (userId && otherId && userRoleId && otherRoleId) getOrCreateChat();\r\n  }, [userId, otherId, userRoleId, otherRoleId]);\r\n\r\n  // Fetch messages for this chat\r\n  useEffect(() => {\r\n    if (!chatId) return;\r\n    async function fetchMessages() {\r\n      const res = await fetch(`http://localhost:8000/api/chat_message_s/${chatId}`);\r\n      if (res.ok) {\r\n        const msgs = await res.json();\r\n        setMessages(Array.isArray(msgs) ? msgs.filter(Boolean) : []);\r\n      }\r\n    }\r\n    fetchMessages();\r\n    const interval = setInterval(fetchMessages, 5000);\r\n    return () => clearInterval(interval);\r\n  }, [chatId]);\r\n\r\n  useEffect(() => {\r\n    chatEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n\r\n  async function sendMessage() {\r\n    if (!input.trim() || !chatId) return;\r\n    const newMsg = {\r\n      message: input,\r\n      sender_id: userId,\r\n      sender_role_id: userRoleId,\r\n      receiver_id: otherId,\r\n      msg_type: \"text\",\r\n    };\r\n    const res = await fetch(`http://localhost:8000/api/chat_message_s/${chatId}`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify(newMsg),\r\n    });\r\n    if (res.ok) {\r\n      const saved = await res.json();\r\n      setMessages((prev) => [...prev, saved]);\r\n      setInput(\"\");\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"bg-white/90 shadow-xl rounded-xl w-full mt-8 animate__animated animate__fadeIn\">\r\n      <div className=\"flex items-center gap-3 p-4 border-b bg-gradient-to-r from-green-200 to-blue-200\">\r\n        <div>\r\n          <div className=\"font-bold text-lg text-green-700\">{receiverName || \"Chat\"}</div>\r\n        </div>\r\n      </div>\r\n      <div className=\"p-6 h-96 overflow-y-auto bg-gradient-to-br from-white to-blue-50\">\r\n        {(messages || [])\r\n          .filter((msg) => msg && typeof msg === \"object\" && \"id\" in msg)\r\n          .map((msg, idx) => (\r\n            <div\r\n              key={msg.id || idx}\r\n              className={`mb-2 flex ${msg.sender_id === userId ? \"justify-end\" : \"justify-start\"}`}\r\n            >\r\n              <div\r\n                className={`p-2 rounded-lg max-w-xs ${\r\n                  msg.sender_id === userId ? \"bg-green-500 text-white\" : \"bg-gray-200\"\r\n                }`}\r\n              >\r\n                {msg.message}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        <div ref={chatEndRef} />\r\n      </div>\r\n      <div className=\"p-4 border-t bg-white flex gap-2\">\r\n        <input\r\n          className=\"flex-1 border rounded px-3 py-2 focus:ring-2 focus:ring-green-300\"\r\n          placeholder=\"Type your message...\"\r\n          value={input}\r\n          onChange={(e) => setInput(e.target.value)}\r\n          onKeyDown={(e) => e.key === \"Enter\" && sendMessage()}\r\n        />\r\n        <button\r\n          className=\"bg-green-600 text-white px-5 py-2 rounded hover:bg-green-700 transition\"\r\n          onClick={sendMessage}\r\n        >\r\n          Send\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}